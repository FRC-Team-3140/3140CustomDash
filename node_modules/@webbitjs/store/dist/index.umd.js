(function(n,c){typeof exports=="object"&&typeof module<"u"?c(exports):typeof define=="function"&&define.amd?define(["exports"],c):(n=typeof globalThis<"u"?globalThis:n||self,c(n.MyLib={}))})(this,function(n){"use strict";var se=(n,c,l)=>{if(!c.has(n))throw TypeError("Cannot "+l)};var t=(n,c,l)=>(se(n,c,"read from private field"),l?l.call(n):c.get(n)),o=(n,c,l)=>{if(c.has(n))throw TypeError("Cannot add the same private member more than once");c instanceof WeakSet?c.add(n):c.set(n,l)},d=(n,c,l,q)=>(se(n,c,"write to private field"),q?q.call(n,l):c.set(n,l),l);var h=(n,c,l)=>(se(n,c,"access private method"),l);var C,p,z,v,R,y,D,U,j,S,O,g,V,Z,Q,He,X,ze,K,ie,k,De,m,H,b,W,F,J,E,x,T,w,L,M,P,Y,G,oe,N,ne;var c=1/0,l="[object Symbol]",q=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ze=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,$="\\ud800-\\udfff",ce="\\u0300-\\u036f\\ufe20-\\ufe23",ae="\\u20d0-\\u20f0",he="\\u2700-\\u27bf",fe="a-z\\xdf-\\xf6\\xf8-\\xff",Ke="\\xac\\xb1\\xd7\\xf7",We="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Fe="\\u2000-\\u206f",Je=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",de="A-Z\\xc0-\\xd6\\xd8-\\xde",le="\\ufe0e\\ufe0f",be=Ke+We+Fe+Je,ee="['’]",Ge="["+$+"]",Se="["+be+"]",B="["+ce+ae+"]",xe="\\d+",Ne="["+he+"]",ge="["+fe+"]",pe="[^"+$+be+xe+he+fe+de+"]",re="\\ud83c[\\udffb-\\udfff]",Ye="(?:"+B+"|"+re+")",ve="[^"+$+"]",te="(?:\\ud83c[\\udde6-\\uddff]){2}",ue="[\\ud800-\\udbff][\\udc00-\\udfff]",A="["+de+"]",me="\\u200d",ye="(?:"+ge+"|"+pe+")",qe="(?:"+A+"|"+pe+")",je="(?:"+ee+"(?:d|ll|m|re|s|t|ve))?",Oe="(?:"+ee+"(?:D|LL|M|RE|S|T|VE))?",Ee=Ye+"?",Pe="["+le+"]?",$e="(?:"+me+"(?:"+[ve,te,ue].join("|")+")"+Pe+Ee+")*",Ae=Pe+Ee+$e,Be="(?:"+[Ne,te,ue].join("|")+")"+Ae,_e="(?:"+[ve+B+"?",B,te,ue,Ge].join("|")+")",Qe=RegExp(ee,"g"),Xe=RegExp(B,"g"),ke=RegExp(re+"(?="+re+")|"+_e+Ae,"g"),er=RegExp([A+"?"+ge+"+"+je+"(?="+[Se,A,"$"].join("|")+")",qe+"+"+Oe+"(?="+[Se,A+ye,"$"].join("|")+")",A+"?"+ye+"+"+je,A+"+"+Oe,xe,Be].join("|"),"g"),rr=RegExp("["+me+$+ce+ae+le+"]"),tr=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ur={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"ss"},sr=typeof global=="object"&&global&&global.Object===Object&&global,ir=typeof self=="object"&&self&&self.Object===Object&&self,or=sr||ir||Function("return this")();function nr(s,e,r,u){var i=-1,a=s?s.length:0;for(u&&a&&(r=s[++i]);++i<a;)r=e(r,s[i],i,s);return r}function cr(s){return s.split("")}function ar(s){return s.match(q)||[]}function hr(s){return function(e){return s==null?void 0:s[e]}}var fr=hr(ur);function Ce(s){return rr.test(s)}function dr(s){return tr.test(s)}function lr(s){return Ce(s)?br(s):cr(s)}function br(s){return s.match(ke)||[]}function Sr(s){return s.match(er)||[]}var xr=Object.prototype,gr=xr.toString,Re=or.Symbol,Ue=Re?Re.prototype:void 0,Ve=Ue?Ue.toString:void 0;function pr(s,e,r){var u=-1,i=s.length;e<0&&(e=-e>i?0:i+e),r=r>i?i:r,r<0&&(r+=i),i=e>r?0:r-e>>>0,e>>>=0;for(var a=Array(i);++u<i;)a[u]=s[u+e];return a}function vr(s){if(typeof s=="string")return s;if(Er(s))return Ve?Ve.call(s):"";var e=s+"";return e=="0"&&1/s==-c?"-0":e}function mr(s,e,r){var u=s.length;return r=r===void 0?u:r,!e&&r>=u?s:pr(s,e,r)}function yr(s){return function(e){e=_(e);var r=Ce(e)?lr(e):void 0,u=r?r[0]:e.charAt(0),i=r?mr(r,1).join(""):e.slice(1);return u[s]()+i}}function jr(s){return function(e){return nr(Rr(Ar(e).replace(Qe,"")),s,"")}}function Or(s){return!!s&&typeof s=="object"}function Er(s){return typeof s=="symbol"||Or(s)&&gr.call(s)==l}function _(s){return s==null?"":vr(s)}var Te=jr(function(s,e,r){return e=e.toLowerCase(),s+(r?Pr(e):e)});function Pr(s){return Cr(_(s).toLowerCase())}function Ar(s){return s=_(s),s&&s.replace(Ze,fr).replace(Xe,"")}var Cr=yr("toUpperCase");function Rr(s,e,r){return s=_(s),e=r?void 0:e,e===void 0?dr(s)?Sr(s):ar(s):s.match(e)||[]}class we{constructor(e,r,u,i){o(this,C,void 0);o(this,p,{});o(this,z,void 0);o(this,v,void 0);o(this,R,!1);o(this,y,void 0);o(this,D,void 0);d(this,D,e),d(this,y,r),d(this,C,u),d(this,z,i)}getKey(){return t(this,C)}hasValue(){return t(this,R)}getValue(){return t(this,v)}setValue(e){d(this,v,e),d(this,R,!0)}removeValue(){d(this,v,void 0),d(this,R,!1)}getSourceValue(){return this.hasChildren()?t(this,y):t(this,v)}setSourceValue(e){t(this,D).userUpdate(t(this,C),e)}getChildren(){return t(this,p)}hasChildren(){return Object.getOwnPropertyNames(t(this,p)).length>0}addChild(e,r){const u=e.split("/").at(-1);typeof u>"u"||(t(this,p)[u]=r,!(typeof u>"u")&&Object.defineProperty(t(this,y),u,{configurable:!0,enumerable:!0,set(i){r.setSourceValue(i)},get(){return r.getSourceValue()}}))}removeChild(e){const r=e.split("/").at(-1);typeof r<"u"&&(delete t(this,p)[r],delete t(this,y)[r])}getParent(){return t(this,z)}getJson(e=!0){if(this.hasChildren()){const r={};return Object.entries(t(this,p)).forEach(([u,i])=>{const a=e?Te(u):u;r[a]=i.getJson(e)}),r}return t(this,v)}}C=new WeakMap,p=new WeakMap,z=new WeakMap,v=new WeakMap,R=new WeakMap,y=new WeakMap,D=new WeakMap;function Ur(s){return s.hasValue()?!1:Object.keys(s.getChildren()).length===0}class Vr{constructor(e){o(this,Q);o(this,X);o(this,K);o(this,k);o(this,m);o(this,U,new Map);o(this,j,new Set);o(this,S,new Map);o(this,O,void 0);o(this,g,{});o(this,V,new Map);o(this,Z,void 0);d(this,O,e),d(this,Z,{clearSources:e.addClearSourcesHandler(()=>{this.clearSources()}),sourcesChanged:e.addSourcesChangedHandler(r=>{Object.entries(r).forEach(([u,i])=>{this.updateSource(u,i,!1)}),Object.entries(r).forEach(([u])=>{h(this,m,H).call(this,u)})}),sourcesRemoved:e.addSourcesRemovedHandler(r=>{const u=r.filter(i=>t(this,S).has(i));u.forEach(i=>this.removeSource(i),!1),u.forEach(i=>{h(this,m,H).call(this,i)})})})}getSourceProvider(){return t(this,O)}getSource(e){return t(this,S).get(e)}getSourceValue(e){var r;return(r=this.getSource(e))==null?void 0:r.getSourceValue()}updateSource(e,r,u=!0){h(this,Q,He).call(this,e),h(this,X,ze).call(this,e);const i=t(this,S).get(e);i==null||i.setValue(r),u&&h(this,m,H).call(this,e)}clearSources(){const e=[];t(this,S).forEach((r,u)=>{e.push(u),this.removeSource(u,!1)}),e.forEach(r=>h(this,m,H).call(this,r))}removeSource(e,r=!0){const u=t(this,S).get(e);u&&(u.removeValue(),h(this,K,ie).call(this,u),r&&h(this,m,H).call(this,e),t(this,j).delete(e))}subscribe(e,r,u){var a;typeof t(this,g)[e]>"u"&&(t(this,g)[e]=new Map);const i=Symbol("SourceSubscriber");return t(this,g)[e].set(i,r),u&&((a=this.getSource(e))!=null&&a.hasValue()||t(this,O).requestSource(e),r(this.getSourceValue(e),e,e)),()=>{t(this,g)[e].delete(i)}}subscribeAll(e,r){const u=Symbol("SourceSubscriberAll");return t(this,V).set(u,e),r&&t(this,j).forEach(i=>{e(this.getSourceValue(i),i)}),()=>{t(this,V).delete(u)}}unsubscribeFromProvider(){const{clearSources:e,sourcesChanged:r,sourcesRemoved:u}=t(this,Z);e(),r(),u()}}U=new WeakMap,j=new WeakMap,S=new WeakMap,O=new WeakMap,g=new WeakMap,V=new WeakMap,Z=new WeakMap,Q=new WeakSet,He=function(e){t(this,j).has(e)||t(this,j).add(e)},X=new WeakSet,ze=function(e){const r=e.split("/");let u;r.forEach((i,a)=>{const f=r.slice(0,a+1).join("/");if(!t(this,S).has(f)){const I=t(this,S).get(u),Ie=new we(t(this,O),h(this,k,De).call(this,f),f,I);t(this,S).set(f,Ie),I==null||I.addChild(f,Ie)}u=f})},K=new WeakSet,ie=function(e){const r=Ur(e),u=e.getParent();r&&u&&(u.removeChild(e.getKey()),t(this,S).delete(e.getKey()),h(this,K,ie).call(this,u))},k=new WeakSet,De=function(e){return t(this,U).has(e)||t(this,U).set(e,{}),t(this,U).get(e)},m=new WeakSet,H=function(e){const r=e.split("/"),u=this.getSourceValue(e);r.forEach((i,a)=>{const f=r.slice(0,a+1).join("/");f in t(this,g)&&t(this,g)[f].forEach(I=>{I(this.getSourceValue(f),f,e)})}),t(this,V).forEach(i=>{i(u,e)})};class Le{constructor(){o(this,b,{});o(this,W,[]);o(this,F,void 0);o(this,J,[])}hasSourceProvider(e){return e in t(this,b)}addSourceProvider(e,r){if(this.hasSourceProvider(e))throw new Error("A source provider with that name has already been added.");const u=new Vr(r);t(this,b)[e]=u,t(this,W).forEach(i=>{i(e)})}sourceProviderAdded(e){t(this,W).push(e)}removeSourceProvider(e){if(!this.hasSourceProvider(e))return;this.getSourceProvider(e).disconnect(),t(this,b)[e].unsubscribeFromProvider(),delete t(this,b)[e]}getSourceProvider(e){return t(this,b)[e].getSourceProvider()}getSourceProviderNames(){return Object.keys(t(this,b))}setDefaultSourceProvider(e){d(this,F,e),t(this,J).forEach(r=>{r(e)})}defaultSourceProviderSet(e){if(typeof e!="function")throw new Error("listener is not a function");t(this,J).push(e)}getDefaultSourceProvider(){return t(this,F)}getSource(e,r){var u;return(u=t(this,b)[e])==null?void 0:u.getSource(r)}getSourceValue(e,r){var u;return(u=t(this,b)[e])==null?void 0:u.getSourceValue(r)}subscribe(e,r,u,i){var a;return(a=t(this,b)[e])==null?void 0:a.subscribe(r,u,i)}subscribeAll(e,r,u){var i;return(i=t(this,b)[e])==null?void 0:i.subscribeAll(r,u)}}b=new WeakMap,W=new WeakMap,F=new WeakMap,J=new WeakMap;const Me=()=>{},Tr=s=>s.split("/").map(e=>Te(e)).join("/");class wr{constructor(e={},r=0){o(this,P);o(this,G);o(this,N);o(this,E,void 0);o(this,x,{});o(this,T,void 0);o(this,w,new Map);o(this,L,new Map);o(this,M,new Map);r&&d(this,E,setInterval(h(this,P,Y).bind(this),r)),Object.entries(e).forEach(([u,i])=>{this.updateSource(u,i)})}updateSource(e,r){clearTimeout(t(this,T)),t(this,x)[e]===void 0?t(this,x)[e]={first:{type:"change",value:r}}:t(this,x)[e].last={type:"change",value:r},t(this,E)||h(this,P,Y).call(this)}removeSource(e){t(this,x)[e]===void 0?t(this,x)[e]={first:{type:"removal"}}:t(this,x)[e].last={type:"removal"},t(this,E)||h(this,P,Y).call(this)}clearSources(e=Me){h(this,P,Y).call(this,()=>{t(this,w).forEach(r=>r()),e()})}clearSourcesWithTimeout(e,r){clearTimeout(t(this,T)),d(this,T,setTimeout(()=>{this.clearSources(r)},e))}userUpdate(e,r){this.updateSource(e,r)}requestSource(e){}static getType(e){return typeof e=="string"?"string":typeof e=="number"?"number":typeof e=="boolean"?"boolean":e instanceof Array?"Array":e===null?"null":null}addClearSourcesHandler(e){const r=Symbol("clearSources");return t(this,w).set(r,e),()=>{t(this,w).delete(r)}}addSourcesChangedHandler(e){const r=Symbol("sourcesChanged");return t(this,L).set(r,e),()=>{t(this,L).delete(r)}}addSourcesRemovedHandler(e){const r=Symbol("sourcesRemoved");return t(this,M).set(r,e),()=>{t(this,M).delete(r)}}disconnect(){clearTimeout(t(this,E))}}E=new WeakMap,x=new WeakMap,T=new WeakMap,w=new WeakMap,L=new WeakMap,M=new WeakMap,P=new WeakSet,Y=function(e=Me){if(Object.keys(t(this,x)).length===0){e();return}const r={...t(this,x)};d(this,x,{});const u={},i={};Object.entries(r).forEach(([a,f])=>{u[a]=f.first,typeof f.last<"u"&&(i[a]=f.last)}),h(this,G,oe).call(this,u),h(this,N,ne).call(this,u),Object.keys(i).length>0?setTimeout(()=>{h(this,G,oe).call(this,i),h(this,N,ne).call(this,i),e()}):e()},G=new WeakSet,oe=function(e){const r={};Object.entries(e).forEach(([u,{type:i}])=>{i==="change"&&(r[u]=e[u].value)}),Object.keys(r).length>0&&t(this,L).forEach(u=>u(r))},N=new WeakSet,ne=function(e){const r=[];Object.entries(e).forEach(([u,{type:i}])=>{i==="removal"&&r.push(u)}),r.length>0&&t(this,M).forEach(u=>u(r))},n.Source=we,n.SourceProvider=wr,n.Store=Le,n.default=Le,n.normalizeKey=Tr,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
